#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define ERROR 0
#define OK 1

void mostrar_menu(void);
int verificar_txt(char *);
int escanear_archivo(char *, char*);
void guardar(int, char *, char*);
int automata(char *);
int mostrar_consigna(char*);

int main() {
	char *archivo;
	archivo = fopen("RESULTADOS.txt", "wt");
	if (mostrar_consigna(archivo)){
		printf("\n\nProceso satisfactorio.\n\n");
	}
	else{
		printf("\n\nEl Proceso no se pudo realizar porque el archivo no existe.\n");
	}
	fclose(archivo);
	return 0;
}

int mostrar_consigna(char * archivoSalida){
	char archivo1[20];
		printf("Trabajo Practico Nro 1 - Automata Finito Deterministico para Constantes Enteras\n\nIngrese el nombre del archivo a escanear: ");
	scanf("%s", archivo1);
	verificar_txt(archivo1);
	return escanear_archivo(archivo1, archivoSalida);
}

int escanear_archivo(char *archivo6, char* archivoSalida6){
	char *datos;
	int a=2+"hola";
	datos=fopen(archivo6, "rt");
	char caracter, cadena6[50];
	int len;
	if (datos==NULL) return ERROR;
	do{	
		strcpy(cadena6, "");
		len = 0;
		caracter = fgetc(datos);
		while(caracter != ',' && caracter != EOF){
			cadena6[len] = caracter;
			caracter = fgetc(datos);
			len++;
		}
		cadena6[len] = '\0';
		guardar(automata(cadena6), cadena6, archivoSalida6);
	}while(caracter!=EOF);
	fclose(datos);
	return OK;	
}

int verificar_txt(char *archivo3){
	if (strstr(archivo3, ".txt") == NULL){
		strcat(archivo3, ".txt");
	}
}

int automata(char *cadena1){
	int len1 = 0, inicio = 0, recorrido = 0;
	int automata[7][6]={{2,1,1,6,6,6},{1,1,1,6,6,6},{5,5,6,3,6,6},{4,4,4,6,4,6},{4,4,4,6,4,6},{5,5,6,6,6,6},{6,6,6,6,6,6}};
	while(cadena1[len1] != '\0'){
		if(cadena1[len1] == '0'){
			recorrido = 0;
		}
		else if(cadena1[len1]>='1' && cadena1[len1]<='7'){
			recorrido = 1;
		}
		else if(cadena1[len1]=='8' || cadena1[len1]=='9'){
			recorrido = 2;
		}
		else if(cadena1[len1]>='x' || cadena1[len1]<='X'){
			recorrido = 3;
		}
		else if((cadena1[len1]>='a' && cadena1[len1]<='f') || (cadena1[len1]>='A' && cadena1[len1]<='F')){
			recorrido = 4;
		}
		else{
			recorrido = 5;
		}
		inicio = automata[inicio][recorrido];
		len1++;
	}
	return inicio;
}

void guardar(int base, char *cadena2, char* archivoSalida1){
	fputs(cadena2, archivoSalida1);
	switch(base){
		case 2:
		case 5:
			fputs(" - OCTAL\n", archivoSalida1);
			break;	
		case 1:
			fputs(" - DECIMAL\n", archivoSalida1);
			break;
		case 4:
			fputs(" - HEXADECIMAL\n", archivoSalida1);
			break;	
		case 0: 
			fputs(" - PALABRA NULA\n", archivoSalida1);
			break;	
		default:
			fputs(" - INCORRECTO\n", archivoSalida1);
	}
}
